{% extends "base.html" %}
{% block title %}Profile | Crypto App{% endblock %}
@app.route("/")
def home():
    me = get_current_user()  # tumhara function ya query jo user info laata ho
    return render_template("profile.html", me=me)

{% block content %}
<div class="row g-4">

  <!-- Header -->
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h2>Welcome, {{ me.name if me else 'Guest' }}</h2>
    <div>
      <a href="{{ url_for('logout') }}" class="btn btn-danger">Logout</a>
    </div>
  </div>

  <hr>

  <!-- Left Column: Profile + AI Chat -->
  <div class="col-lg-4">

    <!-- User Profile -->
    <div class="p-4 glass mb-4">
      <h5 class="mb-3">Your Profile</h5>
      {% if me %}
        <div class="small text-secondary">Joined: {{ me.created_at if me.created_at else 'â€”' }}</div>
        <div class="mt-3"><strong>{{ me.name }}</strong><br>{{ me.email }}</div>
        <div class="mt-2">Gender: {{ me.gender if me.gender else 'â€”' }}</div>
      {% else %}
        <p>Loadingâ€¦</p>
      {% endif %}
    </div>

    <!-- AI Assistant Box -->
    <div id="crypto-assistant" class="p-4 glass chat-container">
      <h5>ðŸ’» Crypto AI Mentor</h5>
      <div id="crypto-chat" class="chat-window mb-2" style="height: 250px; overflow-y: auto; border: 1px solid #ccc; padding: 8px; border-radius: 5px;">
        <!-- Chat messages will appear here -->
      </div>
      <div class="d-flex">
        <input type="text" id="crypto-input" class="form-control me-2" placeholder="Ask me anything about crypto...">
        <button id="crypto-send" class="btn btn-primary" type="button">Send</button>
      </div>
    </div>

  </div>

  <!-- Right Column: Encryption & Decryption -->
  <div class="col-lg-8">

    <!-- Encryption Box -->
    <div class="p-4 glass mb-4">
      <h5 class="mb-3">Encryption Workspace</h5>
      <div class="cipher-box">
        <label for="plain-text" class="form-label">Enter Plain Text</label>
        <textarea id="plain-text" class="form-control mb-3" rows="3" placeholder="Type your message..."></textarea>

        <div class="row mb-3">
          <div class="col">
            <label class="form-label">Caesar Key</label>
            <input type="number" id="caesar-key" class="form-control" placeholder="e.g. 3">
          </div>
          <div class="col">
            <label class="form-label">XOR Key</label>
            <input type="number" id="xor-key" class="form-control" placeholder="e.g. 3">
          </div>
        </div>

        <div class="mt-3 text-start">
          <button id="encryptBtn" type="button" class="btn btn-primary me-2">Encrypt</button>
        </div>

        <div class="mt-3">
          <label class="form-label">Encrypted Message</label>
          <div class="d-flex mb-2">
            <textarea id="encrypted-output" class="form-control me-2" rows="3" placeholder="Cipher message..." readonly></textarea>
            <button class="btn btn-outline-secondary" type="button" onclick="copyToClipboard('encrypted-output')">Copy</button>
          </div>

          <!-- EMAIL FORM -->
          <form id="emailForm" class="d-flex">
            <input type="email" id="toEmail" class="form-control me-2" placeholder="receiver@example.com" required>
            <button type="submit" id="sendBtn" class="btn btn-accent">
              <i class="bi bi-send"></i> Send Email
            </button>
          </form>
        </div>
      </div>
    </div>

    <!-- Decryption Box -->
    <div class="p-4 glass">
      <h5 class="mb-3">Decryption Workspace</h5>
      <div class="cipher-box">
        <label for="encrypted-input" class="form-label">Enter Encrypted Message</label>
        <textarea id="encrypted-input" class="form-control mb-3" rows="3" placeholder="Paste your cipher text..."></textarea>

        <div class="row mb-3">
          <div class="col">
            <label class="form-label">Caesar Key</label>
            <input type="number" id="decrypt-caesar-key" class="form-control" placeholder="e.g. 3">
          </div>
          <div class="col">
            <label class="form-label">XOR Key</label>
            <input type="number" id="decrypt-xor-key" class="form-control" placeholder="e.g. 3">
          </div>
        </div>

        <button class="btn btn-success me-2" type="button" onclick="decryptText()">Decrypt</button>

        <div class="mt-3">
          <label class="form-label">Decrypted Message</label>
          <div class="d-flex">
            <textarea id="decrypted-output" class="form-control me-2" rows="3" placeholder="Plain text..." readonly></textarea>
            <button class="btn btn-outline-secondary" type="button" onclick="copyToClipboard('decrypted-output')">Copy</button>
          </div>
        </div>
      </div>
    </div>

  </div>
</div>

<script src="{{ url_for('static', filename='js/profile.js') }}"></script>
<script src="{{ url_for('static', filename='js/chat.js') }}"></script>
{% endblock %}
